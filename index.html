<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4f46e5" />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon.ico">
  <title>Song Association Game</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9fafb;
      color: #111827;
    }

    header {
      background-color: #4f46e5;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
    }

    .tabs {
      display: flex;
      justify-content: center;
      background-color: #e0e7ff;
    }

    .tab {
      padding: 1rem;
      cursor: pointer;
      flex: 1;
      text-align: center;
      font-weight: bold;
      background: #e0e7ff;
      border: none;
      outline: none;
    }

    .tab.active {
      background: #4f46e5;
      color: white;
    }

    .tab-content {
      display: none;
      padding: 1.5rem;
    }

    .tab-content.active {
      display: block;
    }

    button {
      background-color: #4f46e5;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1rem;
    }

    button:hover {
      background-color: #3730a3;
    }

    input, select {
      padding: 0.75rem;
      width: 100%;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
    }

    .word-display {
      font-size: 2rem;
      margin: 2rem 0;
      font-weight: bold;
      text-align: center;
    }

    .score-list {
      list-style-type: none;
      padding: 0;
    }

    .score-list li {
      margin: 0.5rem 0;
      background: #e5e7eb;
      padding: 0.5rem;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <header>ðŸŽµ Song Association Game ðŸŽµ</header>
  <div class="tabs">
    <button class="tab active" onclick="showTab('game')">Game</button>
    <button class="tab" onclick="showTab('settings')">Settings</button>
  </div>

  <div id="game" class="tab-content active">
    <div class="word-display" id="wordDisplay">Press Start!</div>
    <button onclick="nextWord()">Next Word</button>
  </div>

  <div id="settings" class="tab-content">
    <label>Players (comma-separated):</label>
    <input type="text" id="playersInput" placeholder="e.g. Alice, Bob" />

    <label>Language:</label>
    <select id="languageSelect">
      <option value="english">English</option>
      <option value="malay">Malay</option>
      <option value="both">Both</option>
    </select>

    <button onclick="saveSettings()">Save Settings</button>
    <button onclick="refreshWordList()">Refresh Word List</button>
    <button onclick="resetScores()">Reset Scores</button>

    <h3>Scoreboard</h3>
    <ul id="scoreboard" class="score-list"></ul>
  </div>

  <script>
    let wordList = { english: [], malay: [] };
    let languageMode = 'english';
    let players = [];
    let scores = {};
    let currentPlayerIndex = 0;
    let currentLang = 'english';

    document.addEventListener('DOMContentLoaded', () => {
      loadFromLocalStorage();
      fetchWords();
    });

    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
    }

    function fetchWords() {
      const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5MX7qFT32Er41i6EPORV5GH9xsIlh6nwNxsV9_qGTL6PHvDBvNb9I5PhlTycbQyb5-f9ffg4BE5FB/pub?output=csv';
      fetch(url)
        .then(res => res.text())
        .then(csv => {
          const rows = csv.trim().split('\n').map(r => r.split(','));
          rows.forEach(([en, ms]) => {
            if (en) wordList.english.push(en.trim());
            if (ms) wordList.malay.push(ms.trim());
          });
        });
    }

    function nextWord() {
      if (!players.length) {
        alert('Please add players in settings.');
        return;
      }
      if (languageMode === 'both') {
        currentLang = currentLang === 'english' ? 'malay' : 'english';
      } else {
        currentLang = languageMode;
      }
      const list = wordList[currentLang];
      const word = list[Math.floor(Math.random() * list.length)];
      document.getElementById('wordDisplay').textContent = `${players[currentPlayerIndex]}: ${word}`;
      currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    }

    function saveSettings() {
      players = document.getElementById('playersInput').value.split(',').map(p => p.trim()).filter(p => p);
      languageMode = document.getElementById('languageSelect').value;
      currentPlayerIndex = 0;
      if (!players.length) return alert('Please enter at least one player.');
      if (!scores) scores = {};
      players.forEach(p => scores[p] = scores[p] || 0);
      updateScoreboard();
      saveToLocalStorage();
    }

    function refreshWordList() {
      wordList = { english: [], malay: [] };
      fetchWords();
    }

    function resetScores() {
      scores = {};
      players.forEach(p => scores[p] = 0);
      updateScoreboard();
      saveToLocalStorage();
    }

    function updateScoreboard() {
      const ul = document.getElementById('scoreboard');
      ul.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p}: ${scores[p]}`;
        ul.appendChild(li);
      });
    }

    function saveToLocalStorage() {
      localStorage.setItem('sag_players', JSON.stringify(players));
      localStorage.setItem('sag_scores', JSON.stringify(scores));
      localStorage.setItem('sag_language', languageMode);
    }

    function loadFromLocalStorage() {
      players = JSON.parse(localStorage.getItem('sag_players') || '[]');
      scores = JSON.parse(localStorage.getItem('sag_scores') || '{}');
      languageMode = localStorage.getItem('sag_language') || 'english';
      document.getElementById('playersInput').value = players.join(', ');
      document.getElementById('languageSelect').value = languageMode;
      updateScoreboard();
    }
  </script>
</body>

</html>
