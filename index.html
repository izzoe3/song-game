<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Song Association Game</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: auto;
      padding: 1rem;
    }

    h1, h2 {
      text-align: center;
    }

    .hidden {
      display: none;
    }

    input, select, button, textarea {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      border: none;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    .tabs {
      display: flex;
      justify-content: space-around;
      margin-top: 1rem;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 1rem;
      cursor: pointer;
      background: #eee;
      border: 1px solid #ccc;
    }

    .tab.active {
      background: #007bff;
      color: white;
    }

    .word-display {
      font-size: 2.5rem;
      font-weight: bold;
      text-align: center;
      margin: 2rem 0;
    }

    .score-list {
      list-style: none;
      padding: 0;
    }

    .score-list li {
      padding: 0.5rem 0;
    }

    .error {
      color: red;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Start Screen -->
    <div id="start-screen">
      <h1>üéµ Song Association Game</h1>
      <input id="player-names" placeholder="Enter player names, comma-separated">
      <select id="language">
        <option value="english">English</option>
        <option value="malay">Malay</option>
        <option value="both">Both</option>
      </select>
      <button onclick="startGame()">Start Game</button>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('game')">Game</div>
        <div class="tab" onclick="switchTab('settings')">Settings</div>
      </div>

      <div id="game-tab">
        <h2>Sing a song with this word:</h2>
        <div class="word-display" id="word-display">---</div>

        <select id="score-player">
          <option value="">-- Select Player --</option>
        </select>

        <div class="error" id="score-error"></div>

        <button onclick="addScore()">‚úÖ Add Score</button>
        <button onclick="nextWord()">üîÅ Next Word</button>
        <button onclick="skipWord()">‚è≠Ô∏è Skip Word</button>
      </div>

      <div id="settings-tab" class="hidden">
        <h2>Settings</h2>

        <button onclick="toggleScoreboard()">üëÅÔ∏è Toggle Scoreboard</button>
        <ul id="scoreboard" class="score-list hidden"></ul>

        <h3>Adjust Scores</h3>
        <div id="score-adjustments"></div>

        <h3>Add More Players</h3>
        <input id="new-player" placeholder="Add player name">
        <button onclick="addNewPlayer()">Add Player</button>

        <h3>Change Language</h3>
        <select id="language-setting" onchange="changeLanguage(this.value)">
          <option value="english">English</option>
          <option value="malay">Malay</option>
          <option value="both">Both</option>
        </select>

        <h3>Refresh Word List</h3>
        <button onclick="fetchWordList()">üîÑ Refresh Word List</button>
      </div>
    </div>
  </div>

  <script>
    const englishCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5MX7qFT32Er41i6EPORV5GH9xsIlh6nwNxsV9_qGTL6PHvDBvNb9I5PhlTycbQyb5-f9ffg4BE5FB/pub?output=csv";
    let wordList = { english: [], malay: [] };
    let players = [];
    let scores = {};
    let currentLanguage = "english";
    let lastUsedLanguage = "malay"; // To alternate when both

    function fetchWordList() {
      fetch(englishCSV)
        .then(r => r.text())
        .then(csv => {
          const rows = csv.split("\n").map(r => r.trim());
          wordList.english = rows.filter(w => w && /^[a-zA-Z]+$/.test(w));
          wordList.malay = rows.filter(w => w && /^[a-zA-Z]+$/.test(w));
          console.log("Word list loaded");
        });
    }

    fetchWordList();

    function startGame() {
      const names = document.getElementById('player-names').value.split(",").map(n => n.trim()).filter(n => n);
      if (names.length === 0) return alert("Enter at least one name");
      players = names;
      scores = {};
      players.forEach(p => scores[p] = 0);
      currentLanguage = document.getElementById("language").value;
      document.getElementById("language-setting").value = currentLanguage;

      // Fill dropdown
      const dropdown = document.getElementById("score-player");
      dropdown.innerHTML = '<option value="">-- Select Player --</option>';
      players.forEach(p => {
        const opt = document.createElement("option");
        opt.value = opt.text = p;
        dropdown.appendChild(opt);
      });

      document.getElementById("start-screen").classList.add("hidden");
      document.getElementById("main-app").classList.remove("hidden");
      updateScoreboard();
      buildAdjustments();
      nextWord();
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('#game-tab, #settings-tab').forEach(t => t.classList.add('hidden'));

      if (tab === 'game') {
        document.querySelector('.tab:nth-child(1)').classList.add('active');
        document.getElementById('game-tab').classList.remove('hidden');
      } else {
        document.querySelector('.tab:nth-child(2)').classList.add('active');
        document.getElementById('settings-tab').classList.remove('hidden');
      }
    }

    function nextWord() {
      document.getElementById("score-error").innerText = "";
      const player = document.getElementById("score-player").value;
      if (!player) {
        document.getElementById("score-error").innerText = "‚ö†Ô∏è Please select a player who scored!";
        return;
      }

      document.getElementById("score-player").value = "";

      if (currentLanguage === "both") {
        lastUsedLanguage = (lastUsedLanguage === "english") ? "malay" : "english";
      }

      const lang = currentLanguage === "both" ? lastUsedLanguage : currentLanguage;
      const list = wordList[lang];
      const word = list[Math.floor(Math.random() * list.length)];
      document.getElementById("word-display").innerText = word;
    }

    function skipWord() {
      document.getElementById("score-player").value = "";
      nextWord();
    }

    function addScore() {
      const player = document.getElementById("score-player").value;
      if (!player) {
        document.getElementById("score-error").innerText = "‚ö†Ô∏è Please select a player who scored!";
        return;
      }
      scores[player]++;
      updateScoreboard();
      buildAdjustments();
    }

    function updateScoreboard() {
      const board = document.getElementById("scoreboard");
      board.innerHTML = "";
      for (const p of players) {
        const li = document.createElement("li");
        li.textContent = `${p}: ${scores[p]}`;
        board.appendChild(li);
      }
    }

    function toggleScoreboard() {
      document.getElementById("scoreboard").classList.toggle("hidden");
    }

    function buildAdjustments() {
      const container = document.getElementById("score-adjustments");
      container.innerHTML = "";
      players.forEach(p => {
        const row = document.createElement("div");
        row.innerHTML = `
          <label>${p}: <input type="number" value="${scores[p]}" onchange="adjustScore('${p}', this.value)"></label>
        `;
        container.appendChild(row);
      });
    }

    function adjustScore(player, value) {
      scores[player] = parseInt(value);
      updateScoreboard();
    }

    function addNewPlayer() {
      const name = document.getElementById("new-player").value.trim();
      if (!name || players.includes(name)) return;
      players.push(name);
      scores[name] = 0;
      document.getElementById("new-player").value = "";
      const opt = document.createElement("option");
      opt.value = opt.text = name;
      document.getElementById("score-player").appendChild(opt);
      updateScoreboard();
      buildAdjustments();
    }

    function changeLanguage(value) {
      currentLanguage = value;
    }
  </script>
</body>
</html>
