<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Song Association Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      background: #6200ea;
      color: white;
      padding: 1rem;
      width: 100%;
      text-align: center;
    }

    main {
      padding: 1rem;
      max-width: 600px;
      width: 100%;
    }

    #word {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      margin: 1.5rem 0;
    }

    .hidden {
      display: none;
    }

    select, input, button {
      padding: 0.5rem;
      margin: 0.5rem 0;
      font-size: 1rem;
    }

    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    nav button {
      margin: 0.5rem;
    }

    #scoreboard table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    #scoreboard th, #scoreboard td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
  </style>
</head>

<body>
  <header>
    <h1>Song Association Game</h1>
  </header>
  <main>
    <nav>
      <button onclick="showTab('game')">Game</button>
      <button onclick="showTab('settings')">Settings</button>
    </nav>

    <div id="game" class="tab active">
      <div id="word">[No Word]</div>
      <select id="scorer">
        <option value="">-- Select Player --</option>
      </select>
      <button onclick="addPoint()">Add Point</button>
      <button onclick="nextWord()">Next Word</button>
      <button onclick="skipWord()">Skip Word</button>
    </div>

    <div id="settings" class="tab">
      <h2>Settings</h2>
      <label>Player Names (comma separated):</label><br>
      <input type="text" id="playerInput"><br>
      <label for="language">Language:</label>
      <select id="language">
        <option value="english">English</option>
        <option value="malay">Malay</option>
        <option value="both">Both</option>
      </select><br>
      <button onclick="startGame()">Start Game</button>
      <button onclick="refreshWordList()">Refresh Word List</button>
      <button onclick="toggleScoreboard()">Toggle Scoreboard</button>

      <div id="scoreboard" class="hidden">
        <h3>Scores</h3>
        <table>
          <thead><tr><th>Player</th><th>Score</th><th>Adjust</th></tr></thead>
          <tbody id="scoreTable"></tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    let players = [];
    let scores = {};
    let englishWords = [];
    let malayWords = [];
    let currentWord = '';
    let languageSetting = 'english';
    let languageToggle = true;

    function showTab(id) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function startGame() {
      const names = document.getElementById('playerInput').value.split(',').map(name => name.trim()).filter(name => name);
      const scorerSelect = document.getElementById('scorer');
      scorerSelect.innerHTML = '<option value="">-- Select Player --</option>';
      players = names;
      scores = {};
      players.forEach(player => {
        scores[player] = 0;
        const option = document.createElement('option');
        option.value = player;
        option.textContent = player;
        scorerSelect.appendChild(option);
      });
      languageSetting = document.getElementById('language').value;
      nextWord();
      updateScoreboard();
      showTab('game');
    }

    function addPoint() {
      const scorer = document.getElementById('scorer').value;
      if (!scorer) {
        alert('Please select a player to add score.');
        return;
      }
      scores[scorer]++;
      document.getElementById('scorer').value = '';
      nextWord();
    }

    function nextWord() {
      let word = '[No Word]';
      if (languageSetting === 'english' && englishWords.length) {
        word = englishWords[Math.floor(Math.random() * englishWords.length)];
      } else if (languageSetting === 'malay' && malayWords.length) {
        word = malayWords[Math.floor(Math.random() * malayWords.length)];
      } else if (languageSetting === 'both') {
        if (languageToggle && englishWords.length) {
          word = englishWords[Math.floor(Math.random() * englishWords.length)];
        } else if (malayWords.length) {
          word = malayWords[Math.floor(Math.random() * malayWords.length)];
        }
        languageToggle = !languageToggle;
      }
      currentWord = word;
      document.getElementById('word').textContent = word;
    }

    function skipWord() {
      nextWord();
    }

    function updateScoreboard() {
      const scoreTable = document.getElementById('scoreTable');
      scoreTable.innerHTML = '';
      players.forEach(player => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${player}</td>
                         <td>${scores[player]}</td>
                         <td><input type="number" value="${scores[player]}" onchange="scores['${player}'] = parseInt(this.value); updateScoreboard();"></td>`;
        scoreTable.appendChild(row);
      });
    }

    function toggleScoreboard() {
      const sb = document.getElementById('scoreboard');
      sb.classList.toggle('hidden');
      updateScoreboard();
    }

    async function refreshWordList() {
      try {
        const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQyCtv_XXXXX/pub?output=csv'; // Replace with your published CSV URL
        const response = await fetch(url);
        const csvText = await response.text();
        loadWordsFromSheet(csvText);
      } catch (e) {
        console.error('Error loading words:', e);
      }
    }

    function loadWordsFromSheet(csvText) {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      const malayIndex = headers.indexOf('malay');
      const englishIndex = headers.indexOf('english');
      malayWords = [];
      englishWords = [];

      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(',');
        if (malayIndex !== -1 && cols[malayIndex]) malayWords.push(cols[malayIndex].trim());
        if (englishIndex !== -1 && cols[englishIndex]) englishWords.push(cols[englishIndex].trim());
      }
    }

    // Optional: Auto-refresh word list on load
    refreshWordList();
  </script>
</body>

</html>
