<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Song Association Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Fredoka', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #fef9f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .tab-content {
      flex: 1;
      display: none;
      padding: 20px;
    }

    .active-tab {
      display: block;
    }

    .tab-bar {
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #ccc;
      background-color: #fff;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
    }

    .tab-button {
      flex: 1;
      border: none;
      background: none;
      font-size: 18px;
      padding: 10px;
      cursor: pointer;
    }

    .container {
      max-width: 500px;
      margin: auto;
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    button, select, input {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      background-color: #ff6b6b;
      color: white;
      font-weight: bold;
    }

    button:hover {
      background-color: #e85b5b;
    }

    #wordDisplay {
      font-size: 28px;
      text-align: center;
      margin: 20px 0;
    }

    #feedback {
      text-align: center;
      font-size: 14px;
      color: #555;
    }

    #leaderboard ul {
      padding-left: 0;
      list-style: none;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 22px;
      }

      #wordDisplay {
        font-size: 22px;
      }

      .tab-button {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>

  <!-- GAME TAB -->
  <div id="gameTab" class="tab-content active-tab">
    <div class="container">
      <h1>🎵 Song Game</h1>
      <div id="wordDisplay">Tap “🎲 New Word” to start!</div>
      <select id="playerSelect">
        <option value="">🎤 Who sang it?</option>
      </select>
      <button onclick="checkSong()">✅ I Sang It!</button>
      <button onclick="generateWord()">🎲 New Word</button>
      <button onclick="skipWord()">⏭️ Skip</button>
      <select id="languageChangeSelect" onchange="changeLanguage()">
        <option value="en">🇬🇧 English</option>
        <option value="ms">🇲🇾 Malay</option>
        <option value="both">🌐 Both</option>
      </select>
      <div id="feedback"></div>
    </div>
  </div>

  <!-- SETTINGS TAB -->
  <div id="settingsTab" class="tab-content">
    <div class="container">
      <h1>⚙️ Settings</h1>
      <input type="text" id="addPlayerInput" placeholder="➕ Add player (e.g., Ali)">
      <button onclick="addPlayer()">Add Player</button>
      <select id="removePlayerSelect">
        <option value="">🗑️ Remove Player</option>
      </select>
      <button onclick="removePlayer()">Remove Player</button>
      <button onclick="refreshWordList()">🔄 Refresh Word List</button>

      <h2>🏆 Leaderboard</h2>
      <ul id="leaderboardList"></ul>
    </div>
  </div>

  <!-- TAB BAR -->
  <div class="tab-bar">
    <button class="tab-button" onclick="showTab('gameTab')">🎮 Game</button>
    <button class="tab-button" onclick="showTab('settingsTab')">⚙️ Settings</button>
  </div>

  <script>
    let players = {};
    let currentWord = '';
    let languageMode = 'en';
    let useEnglish = true;

    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5MX7qFT32Er41i6EPORV5GH9xsIlh6nwNxsV9_qGTL6PHvDBvNb9I5PhlTycbQyb5-f9ffg4BE5FB/pub?output=csv';
    let wordLists = { english: [], malay: [] };

    async function fetchWords() {
      try {
        const res = await fetch(sheetUrl);
        const csvText = await res.text();
        const rows = csvText.split('\n').map(r => r.split(',').map(c => c.trim()));
        wordLists.malay = rows.slice(1).map(row => row[0]).filter(Boolean);
        wordLists.english = rows.slice(1).map(row => row[1]).filter(Boolean);
      } catch (e) {
        alert("⚠️ Error loading word list");
      }
    }

    function generateWord() {
      let lang = languageMode;
      if (lang === 'both') {
        lang = useEnglish ? 'en' : 'ms';
        useEnglish = !useEnglish;
      }
      const wordPool = lang === 'en' ? wordLists.english : wordLists.malay;
      if (wordPool.length === 0) {
        document.getElementById('wordDisplay').textContent = '⚠️ No words available!';
        return;
      }
      currentWord = wordPool[Math.floor(Math.random() * wordPool.length)];
      document.getElementById('wordDisplay').textContent = `🎯 ${currentWord} (${lang === 'en' ? 'EN' : 'MS'})`;
      document.getElementById('playerSelect').value = '';
      document.getElementById('feedback').textContent = '';
    }

    function checkSong() {
      const player = document.getElementById('playerSelect').value;
      if (!player) {
        document.getElementById('feedback').textContent = '❗ Please select a player.';
        return;
      }
      players[player]++;
      updateLeaderboard();
      document.getElementById('feedback').textContent = `🎉 Great job, ${player}! +1 point`;
      document.getElementById('playerSelect').value = '';
    }

    function skipWord() {
      generateWord();
      document.getElementById('feedback').textContent = '➡️ Skipped! New word.';
    }

    function addPlayer() {
      const name = document.getElementById('addPlayerInput').value.trim();
      if (!name) return;
      if (players[name]) {
        alert("Player already exists!");
        return;
      }
      players[name] = 0;
      document.getElementById('addPlayerInput').value = '';
      updatePlayerDropdowns();
      updateLeaderboard();
    }

    function removePlayer() {
      const name = document.getElementById('removePlayerSelect').value;
      if (!name) return;
      delete players[name];
      updatePlayerDropdowns();
      updateLeaderboard();
    }

    function updatePlayerDropdowns() {
      const playerSelect = document.getElementById('playerSelect');
      const removeSelect = document.getElementById('removePlayerSelect');
      playerSelect.innerHTML = `<option value="">🎤 Who sang it?</option>`;
      removeSelect.innerHTML = `<option value="">🗑️ Remove Player</option>`;
      for (const name in players) {
        const opt1 = new Option(name, name);
        const opt2 = new Option(name, name);
        playerSelect.appendChild(opt1);
        removeSelect.appendChild(opt2);
      }
    }

    function updateLeaderboard() {
      const list = document.getElementById('leaderboardList');
      list.innerHTML = '';
      Object.entries(players).sort((a,b) => b[1] - a[1]).forEach(([name, score]) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${score} pts`;
        list.appendChild(li);
      });
    }

    function changeLanguage() {
      languageMode = document.getElementById('languageChangeSelect').value;
      useEnglish = true;
      document.getElementById('feedback').textContent = `🌐 Language changed to ${languageMode}`;
    }

    function refreshWordList() {
      fetchWords().then(() => {
        alert("✅ Word list refreshed!");
      });
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active-tab'));
      document.getElementById(tabId).classList.add('active-tab');
    }

    window.onload = async () => {
      await fetchWords();
    };
  </script>
</body>
</html>
